<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Supermarket - Virtual Shopping Experience</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', system-ui, sans-serif; }
    .aisle-rect { 
      fill: #e0e7ff; 
      stroke: #6366f1; 
      stroke-width: 2; 
      cursor: pointer;
      transition: all 0.2s;
    }
    .aisle-rect:hover { fill: #c7d2fe; }
    .aisle-rect.highlighted { 
      fill: #fbbf24; 
      stroke: #f59e0b; 
      stroke-width: 3;
      filter: drop-shadow(0 0 8px rgba(245, 158, 11, 0.6));
    }
    .shelf-rect { 
      fill: #ddd6fe; 
      stroke: #8b5cf6; 
      stroke-width: 1.5;
      cursor: pointer;
    }
    .shelf-rect:hover { fill: #c4b5fd; }
    .shelf-rect.highlighted { 
      fill: #34d399; 
      stroke: #059669; 
      stroke-width: 2.5;
      filter: drop-shadow(0 0 6px rgba(5, 150, 105, 0.6));
    }
    .route-line {
      stroke: #ef4444;
      stroke-width: 3;
      fill: none;
      stroke-dasharray: 8, 4;
      animation: dash 1s linear infinite;
    }
    @keyframes dash {
      to { stroke-dashoffset: -12; }
    }
    .product-marker {
      fill: #ef4444;
      animation: pulse 1.5s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { r: 8; opacity: 1; }
      50% { r: 12; opacity: 0.7; }
    }
    
    /* Tablet Optimizations (iPad ~1024x768) */
    @media (max-width: 1200px) {
      /* Reduce overall font sizes by 30% */
      html { font-size: 14px; }
      
      /* Compact header */
      .header-container { padding: 0.5rem 1rem !important; }
      .header-title { font-size: 1.25rem !important; }
      .header-subtitle { font-size: 0.75rem !important; }
      .header-icon { width: 1.75rem !important; height: 1.75rem !important; }
      .header-icon-container { padding: 0.5rem !important; }
      
      /* Tighter spacing in main container */
      .main-container { gap: 0.5rem !important; padding: 0.5rem !important; }
      
      /* Panel padding reduction (40% less) */
      .panel-compact { padding: 0.75rem !important; }
      
      /* Smaller cards and spacing */
      .card-compact { padding: 0.5rem !important; margin-bottom: 0.4rem !important; }
      
      /* Reduce button padding but maintain tap-friendly height */
      .btn-compact { padding: 0.6rem 0.75rem !important; min-height: 44px; }
      
      /* Smaller headings */
      .heading-compact { font-size: 1rem !important; }
      .subheading-compact { font-size: 0.875rem !important; }
      
      /* Reduce map height for tablet */
      .map-container { height: calc(100vh - 180px) !important; max-height: 500px; }
      
      /* Scrollable areas with reduced heights */
      .scroll-compact { max-height: 180px !important; }
      .scroll-medium { max-height: 220px !important; }
    }
    
    /* Stack layout on smaller tablets */
    @media (max-width: 900px) {
      .main-container { flex-direction: column !important; }
      .map-panel { width: 100% !important; }
      .right-panel { width: 100% !important; }
      .map-container { height: 400px !important; }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  
  <!-- Header -->
  <div class="bg-white shadow-lg border-b border-gray-200">
    <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8 py-4 header-container">
      <div class="flex items-center justify-between flex-wrap gap-2">
        <div class="flex items-center space-x-2">
          <div class="bg-gradient-to-br from-blue-500 to-indigo-600 p-3 rounded-xl shadow-lg header-icon-container">
            <svg class="w-8 h-8 text-white header-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl font-bold text-gray-900 header-title">AI Supermarket</h1>
            <p class="text-sm text-gray-600 header-subtitle">Virtual shopping with smart AI recommendations</p>
          </div>
        </div>
        <div class="flex items-center space-x-2">
          <div class="flex items-center space-x-1">
            <label class="text-sm font-semibold text-gray-700">Budget:</label>
            <div class="relative">
              <span class="absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-500 font-semibold text-sm">$</span>
              <input id="budget" type="number" min="0" step="0.01" value="40" 
                     class="w-20 pl-6 pr-2 py-1.5 border-2 border-gray-300 rounded-lg focus:border-indigo-500 font-semibold text-sm btn-compact">
            </div>
          </div>
          <span id="cartBadge" class="px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded-full font-semibold text-sm">
            Cart: 0 items
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Container: Map (left) + Cart/Recommendations (right) -->
  <div class="flex gap-4 px-4 py-4 max-w-full mx-auto main-container">
    
    <!-- LEFT: Store Map (40% width) -->
    <div class="flex-[2] bg-white rounded-2xl shadow-xl p-6 border border-gray-200 panel-compact map-panel">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-xl font-bold text-gray-900 heading-compact">Store Map</h2>
        <div class="flex items-center space-x-1">
          <button onclick="resetMap()" class="text-sm px-2 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium btn-compact">
            Reset View
          </button>
          <div id="currentLocation" class="text-xs text-gray-600 font-medium"></div>
        </div>
      </div>
      
      <!-- SVG Store Map -->
      <div class="border-2 border-gray-300 rounded-xl overflow-auto bg-gray-50 map-container" style="height: calc(100vh - 200px);">
        <svg id="storeMap" width="700" height="500" viewBox="0 0 1100 750" class="mx-auto">
          <!-- Store layout will be rendered here by JavaScript -->
          <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#ef4444" />
            </marker>
          </defs>
        </svg>
      </div>
      
      <!-- Map Legend -->
      <div class="mt-2 flex items-center justify-center space-x-3 text-xs">
        <div class="flex items-center space-x-1">
          <div class="w-3 h-3 bg-indigo-200 border-2 border-indigo-600 rounded"></div>
          <span class="text-gray-700 font-medium">Aisle</span>
        </div>
        <div class="flex items-center space-x-1">
          <div class="w-3 h-3 bg-purple-200 border-2 border-purple-600 rounded"></div>
          <span class="text-gray-700 font-medium">Shelf</span>
        </div>
        <div class="flex items-center space-x-1">
          <div class="w-3 h-3 bg-green-400 border-2 border-green-700 rounded"></div>
          <span class="text-gray-700 font-medium">Highlight</span>
        </div>
        <div class="flex items-center space-x-1">
          <div class="w-6 h-0.5 bg-red-500" style="border-top: 2px dashed;"></div>
          <span class="text-gray-700 font-medium">Route</span>
        </div>
      </div>
    </div>

    <!-- RIGHT: Cart + Recommendations (60% width) -->
    <div class="flex-[3] space-y-2 right-panel">
      
      <!-- Shelf Products Panel (shown when shelf is clicked) -->
      <div id="shelfProductsPanel" class="bg-gradient-to-br from-purple-50 to-indigo-100 rounded-2xl shadow-xl p-4 border-2 border-purple-300 panel-compact" style="display:none;">
        <div class="flex items-center justify-between mb-2">
          <h3 id="shelfProductsTitle" class="text-lg font-bold text-purple-900 subheading-compact">Shelf Products</h3>
          <button onclick="hideShelfProducts()" class="text-sm px-2 py-1.5 bg-gray-200 hover:bg-gray-300 rounded-lg font-medium btn-compact">
            Close
          </button>
        </div>
        <div id="shelfProductsList" class="space-y-2 overflow-y-auto scroll-compact" style="max-height: 300px;">
          <!-- Shelf products will appear here -->
        </div>
      </div>
      
      <!-- Product Browser -->
      <div class="bg-white rounded-2xl shadow-xl p-4 border border-gray-200 panel-compact">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-lg font-bold text-gray-900 subheading-compact">Browse Products</h3>
          <select id="subcatSel" onchange="refreshProducts()" 
                  class="text-sm px-2 py-1.5 border-2 border-gray-300 rounded-lg focus:border-indigo-500 font-medium btn-compact">
            <option value="">All Aisles</option>
          </select>
        </div>
        <div id="productBrowser" class="space-y-2 overflow-y-auto scroll-compact" style="max-height: 250px;">
          <!-- Product cards will appear here -->
        </div>
      </div>

      <!-- Shopping Cart -->
      <div id="cartPanel" class="bg-white rounded-2xl shadow-xl p-4 border-2 border-indigo-200 panel-compact">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-lg font-bold text-gray-900 subheading-compact">Shopping Cart</h3>
          <div id="subtotal" class="text-sm font-semibold text-gray-700"></div>
        </div>
        <div id="cartItems" class="space-y-2 overflow-y-auto scroll-compact" style="max-height: 200px;">
          <p class="text-sm text-gray-500 text-center py-2">Cart is empty</p>
        </div>
        <button id="checkoutBtn" onclick="checkout()" 
                class="w-full mt-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition-all text-sm btn-compact">
          Complete Purchase
        </button>
      </div>

      <!-- AI Budget Recommendations -->
      <div id="budgetSuggestions" class="bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl shadow-xl p-4 border-2 border-indigo-300 panel-compact" style="display:none;">
        <h4 class="text-md font-bold text-indigo-900 mb-2 subheading-compact">ðŸ’¡ Budget-Saving (Semantic)</h4>
        <div id="budgetList" class="space-y-2"></div>
      </div>

      <div id="cfSuggestions" class="bg-gradient-to-br from-purple-50 to-pink-100 rounded-2xl shadow-xl p-4 border-2 border-purple-300 panel-compact" style="display:none;">
        <h4 class="text-md font-bold text-purple-900 mb-2 subheading-compact">ðŸŽ¯ Personalized (CF)</h4>
        <div id="cfList" class="space-y-2"></div>
      </div>

      <div id="hybridSuggestions" class="bg-gradient-to-br from-emerald-50 to-teal-100 rounded-2xl shadow-xl p-4 border-2 border-emerald-300 panel-compact" style="display:none;">
        <h4 class="text-md font-bold text-emerald-900 mb-2 subheading-compact">ðŸ¤– Hybrid AI</h4>
        <div id="hybridList" class="space-y-2"></div>
      </div>
    </div>
  </div>

  <!-- Success Notification -->
  <div id="successNotif" class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-xl" style="display:none;">
    <div class="flex items-center space-x-2">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
      </svg>
      <span id="notifMsg" class="font-semibold"></span>
    </div>
  </div>

  <script src="/static/app.js"></script>
</body>
</html>
